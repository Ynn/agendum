import { createContext, useContext } from 'react';

export type Lang = 'en' | 'fr';

type Dict = typeof strings.en;

export const strings = {
  en: {
    app_name: 'Agendum',
    search_placeholder: 'Search anything...',
    filters: 'Filters',
    loading_core: 'Loading core...',
    no_main_schedule: 'No main schedule selected.',
    go_settings_prefix: 'Go to',
    go_settings_suffix: 'to select your teacher calendar.',
    schedule: 'Schedule',
    courses: 'Courses',
    service: 'Service',
    fix: 'Fix',
    settings: 'Settings',
    language: 'Language',
    language_en: 'English',
    language_fr: 'French',
    theme: 'Theme',
    theme_system: 'System',
    theme_light: 'Light',
    theme_dark: 'Dark',
    show_qr: 'Show QR',
    scan_qr: 'Scan QR',
    qr_scan_hint: 'Point your camera at a QR code containing a calendar URL.',
    camera_not_supported: 'Camera QR scan is not supported on this browser.',
    camera_permission_denied: 'Camera access denied. Please allow camera permissions.',
    qr_invalid_url: 'Scanned value is not a valid URL.',
    close: 'Close',
    data_and_privacy: 'Data & Privacy',
    purge_all: 'Purge all data',
    purge_all_desc: 'Removes all calendars, settings, and cached app data on this device.',
    purge_all_confirm: 'Purge all local data? This cannot be undone.',

    settings_title: 'Settings & Data',
    my_schedule: 'My Schedule',
    my_schedule_desc: 'Select the calendar that represents your personal service. This will be the default view in the Agenda and the source for service calculations.',
    no_calendars: 'No calendars imported yet.',
    data_sources: 'Data Sources (Resources)',
    import_new_source: '+ Import New Source',
    data_sources_desc: 'Manage external calendars (Promos, colleagues, room schedules) used for information lookup.',
    teacher_identity: 'Teacher Identity',
    teacher_identity_desc: 'Pick your name so service totals focus on your teaching hours. The list is ordered by frequency in service calendars.',
    teacher_select_label: 'Your name',
    teacher_select_none: 'All teachers',
    events_count: '{count} events',

    calendars: 'Calendars',
    import: 'Import',
    no_calendars_imported: 'No calendars imported.',
    include_in_service: 'Include in service',

    import_calendar: 'Import Calendar',
    calendar_type: 'Calendar Type',
    teacher_schedule: 'Teacher Schedule (Service)',
    teacher_schedule_desc: 'Events represent your service (CM/TD/TP hours). Counts in service.',
    resource_promo: 'Resource / Promotion',
    resource_promo_desc: 'For information (Promos, Rooms). Does not count in your service.',
    file_upload: 'File Upload',
    import_via_url: 'Import from URL',
    calendar_name_label: 'Calendar name',
    calendar_name_placeholder: 'e.g. L3 MIAGE S6',
    calendar_url_label: 'Calendar URL',
    calendar_url_placeholder: 'https://planning.univ-rennes1.fr/jsp/custom/modules/plannings/...',
    import_url: 'Import URL',
    source_file: 'File',
    source_url: 'URL',
    refresh: 'Refresh',
    rename: 'Rename',
    refresh_wait: 'Wait {minutes} min',
    last_sync_never: 'Never synced',
    last_sync_prefix: 'Last sync:',
    sync_error: 'Sync error',
    drag_drop: 'Drag & drop .ics file here or click to browse',
    parsing: 'Parsing...',
    cancel: 'Cancel',
    error_parse: 'Failed to parse file.',
    error_parse_desc: 'Check the file format and try again.',
    error_label: 'Error',

    grouping: 'Grouping',
    by_teacher: 'By Teacher',
    global_mix: 'Global Mix',
    options: 'Options',
    merge_subjects: 'Merge Subjects',
    show_empty: 'Show Empty',
    include_totals: 'Show in Service',
    no_events_service: 'No events found for service. Ensure calendars are marked as "Service" in Settings.',
    subject: 'Subject',
    reunion: 'Reunion',
    exam: 'Exam',
    other: 'Other',
    total: 'Total',
    smart_dedupe_note: '* Smart deduplication applied. Matches by time/subject/type across same teacher calendars are counted once.',

    subjects: 'Subjects (UE)',
    filter_subjects: 'Filter subjects...',
    select_subject_hint: 'Select a subject from the left sidebar to view details.',
    list: 'List',
    calendar: 'Calendar',
    total_label: 'Total',
    type: 'Type',
    date: 'Date',
    time: 'Time',
    teacher: 'Teacher',
    promo: 'Promo',
    location: 'Location',
    duration: 'Duration',
    source_teacher: 'Source / Teacher',
    unknown: 'Unknown',
    unknown_teacher: 'Unknown Teacher',
    unknown_subject: 'Unknown',
    teacher_breakdown_note: '* Breakdown based on teacher names extracted from event descriptions.',

    search_results_for: 'Search results for',
    found_events: 'Found {count} matching events.',
    no_results: 'No results found. Try a different term.',
    calendar_source: 'Calendar Source',
    source: 'Source',
    source_service: 'Service calendars',
    source_main: 'Main calendar',
    source_visible: 'Visible calendars',
    source_all: 'All calendars',

    filters_title: 'Filters',
    date_range: 'Date Range',
    to: 'to',
    time_of_day: 'Time of Day',
    days: 'Days',
    reset: 'Reset',
    apply_filters: 'Apply Filters',

    fix_teachers: 'Teachers',
    fix_promos: 'Promos',
    fix_subjects: 'Subjects',
    merge_selected_into: 'Merge selected into...',
    merge: 'Merge',
    reset_fixes: 'Reset fixes',
    fix_hint: 'Select rows to merge, or rename individually. Applied mappings show in gray with an undo. Hide removes a value from lists.',
    fix_search_placeholder: 'Search values...',
    fix_select_hint: 'Select a value to see details.',
    value: 'Value',
    count: 'Count',
    examples: 'Examples',
    rename_merge_into: 'Rename / Merge into',
    actions: 'Actions',
    apply: 'Apply',
    use_as_target: 'Use as target',
    hide: 'Hide',
    unhide: 'Unhide',
    hidden_label: 'Hidden'
  },
  fr: {
    app_name: 'Agendum',
    search_placeholder: 'Rechercher...',
    filters: 'Filtres',
    loading_core: 'Chargement du noyau...',
    no_main_schedule: 'Aucun agenda principal sélectionné.',
    go_settings_prefix: 'Allez dans',
    go_settings_suffix: 'pour choisir votre calendrier enseignant.',
    schedule: 'Agenda',
    courses: 'Cours',
    service: 'Service',
    fix: 'Correction',
    settings: 'Paramètres',
    language: 'Langue',
    language_en: 'Anglais',
    language_fr: 'Français',
    theme: 'Thème',
    theme_system: 'Système',
    theme_light: 'Clair',
    theme_dark: 'Sombre',
    show_qr: 'Afficher QR',
    scan_qr: 'Scanner QR',
    qr_scan_hint: 'Pointez la caméra vers un QR code contenant une URL de calendrier.',
    camera_not_supported: 'Le scan QR caméra n’est pas supporté par ce navigateur.',
    camera_permission_denied: 'Accès caméra refusé. Autorisez la caméra.',
    qr_invalid_url: 'La valeur scannée n’est pas une URL valide.',
    close: 'Fermer',
    data_and_privacy: 'Données & confidentialité',
    purge_all: 'Purger toutes les données',
    purge_all_desc: 'Supprime tous les calendriers, paramètres et données cache de l’application sur cet appareil.',
    purge_all_confirm: 'Purger toutes les données locales ? Cette action est irréversible.',

    settings_title: 'Paramètres & Données',
    my_schedule: 'Mon Agenda',
    my_schedule_desc: 'Sélectionnez le calendrier qui représente votre service. Ce sera la vue par défaut et la source du calcul de service.',
    no_calendars: 'Aucun calendrier importé.',
    data_sources: 'Sources de données (Ressources)',
    import_new_source: '+ Importer une source',
    data_sources_desc: 'Gérez les calendriers externes (promos, collègues, salles) utilisés à titre informatif.',
    teacher_identity: 'Identité Enseignant',
    teacher_identity_desc: 'Choisissez votre nom pour focaliser le calcul du service sur vos heures. La liste est triée par fréquence.',
    teacher_select_label: 'Votre nom',
    teacher_select_none: 'Tous les enseignants',
    events_count: '{count} événements',

    calendars: 'Calendriers',
    import: 'Importer',
    no_calendars_imported: 'Aucun calendrier importé.',
    include_in_service: 'Inclure dans le service',

    import_calendar: 'Importer un calendrier',
    calendar_type: 'Type de calendrier',
    teacher_schedule: 'Calendrier enseignant (Service)',
    teacher_schedule_desc: 'Ces événements représentent votre service (CM/TD/TP). Compte dans le service.',
    resource_promo: 'Ressource / Promotion',
    resource_promo_desc: 'Pour information (promos, salles). Ne compte pas dans le service.',
    file_upload: 'Import fichier',
    import_via_url: 'Import depuis une URL',
    calendar_name_label: 'Nom du calendrier',
    calendar_name_placeholder: 'ex. L3 MIAGE S6',
    calendar_url_label: 'URL du calendrier',
    calendar_url_placeholder: 'https://planning.univ-rennes1.fr/jsp/custom/modules/plannings/...',
    import_url: 'Importer l’URL',
    source_file: 'Fichier',
    source_url: 'URL',
    refresh: 'Rafraîchir',
    rename: 'Renommer',
    refresh_wait: 'Attendre {minutes} min',
    last_sync_never: 'Jamais synchronisé',
    last_sync_prefix: 'Dernière sync :',
    sync_error: 'Erreur de sync',
    drag_drop: 'Glissez-déposez un fichier .ics ici ou cliquez pour parcourir',
    parsing: 'Analyse en cours...',
    cancel: 'Annuler',
    error_parse: 'Impossible de parser le fichier.',
    error_parse_desc: 'Vérifiez le format puis réessayez.',
    error_label: 'Erreur',

    grouping: 'Regroupement',
    by_teacher: 'Par enseignant',
    global_mix: 'Vue globale',
    options: 'Options',
    merge_subjects: 'Fusionner les matières',
    show_empty: 'Afficher vides',
    include_totals: 'Afficher dans le service',
    no_events_service: 'Aucun événement pour le service. Vérifiez que les calendriers sont marqués comme "Service" dans les paramètres.',
    subject: 'Matière',
    reunion: 'Réunion',
    exam: 'Examen',
    other: 'Autre',
    total: 'Total',
    smart_dedupe_note: '* Déduplication intelligente appliquée. Les mêmes créneaux (temps/matière/type) sont comptés une seule fois.',

    subjects: 'Matières (UE)',
    filter_subjects: 'Filtrer les matières...',
    select_subject_hint: 'Sélectionnez une matière dans la colonne de gauche.',
    list: 'Liste',
    calendar: 'Calendrier',
    total_label: 'Total',
    type: 'Type',
    date: 'Date',
    time: 'Horaire',
    teacher: 'Enseignant',
    promo: 'Promo',
    location: 'Salle',
    duration: 'Durée',
    source_teacher: 'Source / Enseignant',
    unknown: 'Inconnu',
    unknown_teacher: 'Enseignant inconnu',
    unknown_subject: 'Inconnu',
    teacher_breakdown_note: '* Répartition basée sur les noms d’enseignants extraits des descriptions.',

    search_results_for: 'Résultats de recherche pour',
    found_events: '{count} événements trouvés.',
    no_results: 'Aucun résultat. Essayez un autre terme.',
    calendar_source: 'Source calendrier',
    source: 'Source',
    source_service: 'Calendriers service',
    source_main: 'Agenda principal',
    source_visible: 'Calendriers visibles',
    source_all: 'Tous les calendriers',

    filters_title: 'Filtres',
    date_range: 'Plage de dates',
    to: 'à',
    time_of_day: 'Heure de la journée',
    days: 'Jours',
    reset: 'Réinitialiser',
    apply_filters: 'Appliquer',

    fix_teachers: 'Enseignants',
    fix_promos: 'Promos',
    fix_subjects: 'Matières',
    merge_selected_into: 'Fusionner vers...',
    merge: 'Fusionner',
    reset_fixes: 'Réinitialiser',
    fix_hint: 'Sélectionnez des lignes pour fusionner ou renommez individuellement. Les mappings appliqués sont en gris. Masquer retire la valeur des listes.',
    fix_search_placeholder: 'Rechercher une valeur...',
    fix_select_hint: 'Sélectionnez une valeur pour voir les détails.',
    value: 'Valeur',
    count: 'Compte',
    examples: 'Exemples',
    rename_merge_into: 'Renommer / Fusionner',
    actions: 'Actions',
    apply: 'Appliquer',
    use_as_target: 'Utiliser comme cible',
    hide: 'Masquer',
    unhide: 'Afficher',
    hidden_label: 'Masqué'
  }
} as const;

export const LangContext = createContext<Lang>('en');

export const useLang = (): Lang => useContext(LangContext);

export const useT = () => {
  const lang = useLang();
  const dict = (strings[lang] ?? strings.en) as Dict;
  return dict;
};

export const detectLang = (): Lang => {
  if (typeof navigator !== 'undefined' && navigator.language) {
    const lower = navigator.language.toLowerCase();
    return lower.startsWith('fr') ? 'fr' : 'en';
  }
  return 'en';
};
